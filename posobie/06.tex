\lr{Обработка изображений}
\theory
Изображение представляет собой двумерную функцию $f(x,y)$, где~$x$ и~$y$~---
пространственные координаты, а уровень~$f$ называется\ж интенсивностью\н или\ж
уровнем серого\н изображения в данной точке (цветное изображение является
совокупностью по крайней мере трех функций $r(x,y)$, $g(x,y)$ и~$b(x,y)$).
Если величины~$x$, $y$ и~$f$ принимают дискретные значения, говорят о\к цифровом
изображении\н. Элементарная единица цифрового изображения называется\ж пикселем\н
(pixel~--- picture element).
Под\к цифровой обработкой изображений\н подразумевается обработка
цифровых изображений с помощью~ЭВМ.

В отличие от человека, чье зрение приспособлено лишь к сравнительно узкому
частотному диапазону, ЭВМ все равно, каковы частоты в обрабатываемом ею изображении.
Т.е. к цифровым изображениям следует относить также: ультразвуковые,
рентгеновские, электронные (микроскопия), магнитнорезонансные (томография) и
прочие изображения.

Несмотря на то, что в окружающем нас мире нет ничего непрерывного (абсолютно все
в нашей Вселенной подвержено квантованию), на уровне классической физики основные
наблюдаемые можно считать непрерывными, т.к. по сравнению с их величиной величина
кванта наблюдаемой пренебрежимо мала (сравните средний рост человека и квант
пространства). Однако, даже самый современный суперкомпьютер по своей производительности
не может сравниться с человеческим мозгом. Поэтому для обработки изображения
при помощи компьютера его необходимо\ж квантовать\н, т.е. преобразовать из
квазинепрерывной формы в дискретную. Квантование производится как в пространстве
координат, так и в пространстве амплитуд. Следовательно, процедуру квантования
(\it{}дискретизации\rm) квазинепрерывного изображения $I_0(X,Y)$ в его
дискретную форму $I(x,y)$ можно представить в виде:
\begin{equation}
I(x,y)=\mathrm{round}\Bigl(\frac{2^N-1}{I_{max}}\Int_{S_{x,y}}I_0(X,Y)
\,dX\,dY\Bigr)+\delta_{x,y}.
\label{Disk_ima}
\end{equation}

Здесь $I_{max}$~-- максимальная интенсивность дискретизуемого сигнала, $N$~-- разрядность
по интенсивности, интегрирование ведется по площади пикселя с координатами~$(x,y)$,
$\delta_{x,y}$~-- шум дискретизации, возникающий при преобразовании сигнала.

В MATLAB изображению соответствует матрица. Если изображение серое, матрица
двумерная. Координаты изображения отсчитываются от первого элемента матрицы,
первая координата~$(x)$ соответствует номеру строки матрицы, вторая~---
номеру~$(y)$ столбца. Цветному изображению соответствует трехмерная матрица, в
которой каждый из слоев соответствует цветовой компоненте~R, G или~B.

Простейшими методами преобразования изображений являются манипуляции в\к
пространственной области\н, т.е. непосредственные операции с пикселями
изображений, которые можно обозначить выражением $g(x,y)=T[f(x,y)]$, где
$T$~-- некоторый оператор над изображением. Оператор~$T$ может применяться
как ко всему изображению, так и к окрестности отдельной точки~$(x_0,y_0)$.
Оператор~$T$ принимает простейший вид при линейных преобразованиях яркости
изображения: $g(x,y)=\lambda\cdot f(x,y)$, либо же при более сложных функциональных
зависимостях,\к одинаковых для всех пикселей изображения\н.

Некоторые типы изображений для более наглядного отображения необходимо логарифмировать.
Человеческие органы чувств работают в шкале логарифмов возмущений (именно поэтому
мощности сигналов по отношению к воздействию на человеческие органы чувств принято
измерять в децибеллах), поэтому в логарифмической шкале некоторые изображения
могут выглядеть значительно четче. Логарифмические преобразования выполняются
при помощи выражения $g(x,y)=\C\ln\bigl(1+f(x,y)\bigr)$. Основное применение
логарифмического преобразования состоит в сжатии динамического диапазона.
Особенно полезным является логарифмическое преобразование Фурье--спектра
изображения (т.к. динамический диапазон Фурье--спектра может быть довольно
значительным и его линейное преобразование не позволит в должной степени отразить
переходы между величинами повышенной и пониженной амплитуд).

\next
\bf Гистограммой\н цифрового изображения, число возможных уровней яркости~$L$ которого
лежит в диапазоне~$[0,G]$, называется дискретная функция~$h(r_k)=n_k$, где
$r_k$~-- $k$-й уровень яркости, $n_k$~-- число пикселей изображения с уровнем
яркости~$r_k$. Часто бывает удобно работать с\к нормированными гистограммами\н,
которые получаются делением~$h(r,k)$ на общее количество пикселей изображения.

Изображения могут иметь низкий динамический диапазон, особенно если они получены
в неподходящих условиях съемки. Для улучшения качества изображения можно
применять\ж эквализацию\н его гистограммы. Эквализация заключается в том, что
гистограмма изображения расширяется на весь возможный динамический диапазон
яркостей. Т.е., минимальная яркость исходного изображения заменяется на нуль,
а максимальная~--- на предельное значение яркости. Остальные величины яркости
равномерно распределяются в расширенном динамическом диапазоне в соответствии с
первоначальной гистограммой.
Кроме того, существуют методы <<подгонки>> гистограммы, когда гистограмма изображения
подгоняется под заданную функцию, т.е. когда уровни яркости отдельных пикселей
меняются в соответствии с их положением на новой гистограмме.

\next
Для коррекции изображений зачастую применяется матричная пространственная фильтрация,
заключающаяся в свертке исходного изображения с некоторой маской, задающей фильтр.
Так, например, фильтр Лапласа, позволяющий получить лапласиан исходного изображения,
реализуется при помощи свертки с маской
$\small\left(\begin{smallmatrix}
0&1&0\\1&-4&1\\0&1&0
\end{smallmatrix}\right)
$, которая получается из дискретного приближения второй производной.

\it Нелинейные фильтры\н определяют значение пикселя нового изображения исходя из
результата упорядочивания значений в некоторой окрестности соответствующего
пикселя исходного изображения. Самым известным из нелинейных фильтров является
медианный фильтр, позволяющий бороться с импульсными шумами <<соль и перец>>
(данный шум изменяет значения яркости в некоторых точках изображения так, что
они принимают нулевое либо максимальное значение).

\next
\bf Двумерное дискретное преобразование Фурье\н~(ДПФ) изображения задается выражением
$$F(u,v)=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)\e^{-2\pi i(\frac{ux}{M}+
\frac{vy}{N})},\; u=\overline{0,M-1},\;v=\overline{0,N-1}.$$
\bf Частотной областью\н называется координатная система, задающая аргументы
$F(u,v)$ частотными переменными~$u$ и~$v$. Обратное ДПФ задается выражением
$$f(x,y)=\rev{MN}\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}F(u,v)\e^{2\pi i(\frac{ux}{M}+
\frac{vy}{N})},\; x=\overline{0,M-1},\;y=\overline{0,N-1}.$$

Даже если изображение~$f$ вещественно, его преобразование Фурье~$F$, как правило,
является комплексным. Для визуализации~$F$ используется вычисление абсолютной
величины этой функции (\it{}спектра\н изображения). Фурье--образ изображения
обладает периодичностью с периодом, равным размеру изображения. Поэтому для
большего удобства визуализации его можно привести к системе координат с нулем
в центре изображения. Для этого в спектре производится перестановка первого и третьего
квадрантов и второго и четвертого.

Фурье--фильтрация изображения формально ничем не отличается от фильтрации одномерных
сигналов. Т.е. если известна функция фильтра~$g(x,y)$, фильтрованное изображение
получается путем свертки
$$f'(x,y)=f(x,y)\otimes g(x,y),$$
или, учитывая свойства Фурье--преобразований,
$$f'(x,y)=\IFT{\FT{f(x,y)}\cdot\FT{g(x,y)}}=\IFT{F(u,v)G(u,v)}.$$
Функцию $G(u,v)$ принято называть\ж передаточной функцией\н фильтра.

Фурье--преобразования некоторых периодических функций могут иметь артефакты,
называемые\ж краевыми эффектами\н: между смежными периодами ДПФ могут возникнуть
эффекты интерференции, искажающие вид спектра изображения. Для избавления от
краевых эффектов следует дополнить изображение (размера $M\times N$) по краям нулями,
сформировав матрицу размером $P\times Q$, где $P\ge 2M-1$, $Q\ge2N-1$.
Алгоритм ДПФ работает быстрее, когда~$P$ и~$Q$ являются степенями двойки, поэтому
эти числа (особенно для больших изображений) стараются выбрать именно исходя из
критерия скорости.

Наиболее распространенными видами фильтрации в частотной области являются
низкочастотная~(НЧ) и высокочастотная~(ВЧ) фильтрация. При НЧ фильтрации осуществляется
размытие изображения, ВЧ фильтрация, наоборот, повышает резкость изображения.

Легко преобразовать НЧ фильтр в соответствующий ему ВЧ фильтр и наоборот. Пусть
$LP(u,v)$~-- передаточная функция НЧ фильтра, тогда передаточная функция соответствующего
ему ВЧ фильтра вычисляется как $HP=1-LP$. Так как ВЧ фильтры отбрасывают нулевую
составляющую изображения (среднюю интенсивность), необходимо добавлять некоторое
смещение к отфильтрованному изображению. ВЧ усиление имеет передаточную
функцию $HP_E(u,v)=a+b\cdot HP(u,v)$, где $a$~-- смещение, $b$~-- коэффициент
усиления.

\next
При получении изображения всегда используются реальные приборы, которые
неизменно добавляют к изображению тот или иной вид шума. Используя
свойства Фурье--преобразований, можно записать спектр полученного изображения
в виде
$$G(u,v)=H(u,v)F(u,v)+N(u,v)\;\Leftrightarrow\;
g(x,y)=h(x,y)\otimes f(x,y)+n(x,y).$$
Функция $h(x,y)$ называется\ж функцией рассеяния точки\н (ФРТ), а ее Фурье--образ
$H(u,v)$~---\ж оптической передаточной функцией\н (ОПФ). Функция $n(x,y)$
характеризует шум.

Для оцифрованных изображений характерен периодический шум
$$n(x,y)=A\sin\Bigl[\rev{M}2\pi u_0(x+B_x)+\rev{N}2\pi v_0(y+B_y)\Bigr],$$
т.е. обратное Фурье--преобразование комплексно--сопряженных единичных импульсов,
находящихся в точках $(u_0,v_0)$ и~$-u_0,-v_0$. Параметры периодического шума
можно оценить по виду Фурье--спектра изображения: такой шум порождает частотные
всплески, которые можно обнаружить даже визуально. Кроме того, в данном случае
хорошие результаты дает исследование изображения при помощи его центральных
моментов. Наиболее часто используются первый нулевой (математическое ожидание)
и второй центральный (дисперсия) моменты.

%\next
Еще одним видом фильтрации является\к адаптивная медианная фильтрация\н. Ее
отличие от <<обычной>> медианной фильтрации в том, что размер окрестности
текущего пикселя, по которой проводится усреднение, изменяется в зависимости
от содержимого этой окрестности. Чем более равномерным является распределение
интенсивности вокруг данной точки, тем большим будет размер окрестности
для фильтрации, и наоборот. Адаптивная медианная фильтрация помогает избавиться
от шумов типа <<соль и перец>>, не смазывая мелких деталей изображения.

\next
Самый простой подход к восстановлению изображения состоит в построении приближения
вида $\hat F(u,v)=G(u,v)/H(u,v)$, после чего $\hat f(x,y)\approx\IFT{F}$.
Такой метод называется\ж инверсной фильтрацией\н.
Однако, вблизи нулей $H$ этот метод дает большие проблемы, кроме того он не
позволяет полностью избавиться от шума.

Более надежным методом является\ж винеровская фильтрация\н. Винеровский фильтр
ищет приближение~$\hat f$, минимизирующее функцию $D=\aver{(f-\hat f)^2}$.
Решение этой задачи в частотной области зависит от спектра искажающей функции и
энергетического спектра шума.

Аналогично одномерным сигналам, в двумерном пространстве также вводятся
вейвлет-преобразования. Фильтрация двумерными вейвлетами позволяет зачастую
добиться результатов, недоступных Фурье--фильтрации.

\next
Особой проблемой в области цифровых изображений является распознавание объектов.
Распознавание объектов применяется в системах распознавания печатного текста,
системах электронного зрения, охранных системах, системах дорожного видеонаблюдения
и многих других. Методика распознавания базируется как на корреляционных
функциях (поиск максимума корреляции изображения с образцом), так и на адаптивных
системах, использующих элементы искусственного интеллекта.

Многие системы распознавания основаны на изучении\ж скелетов\н изображения~---
своего рода каркасов, на которые <<натянуты>> детали изображения. Со скелетами
проще проводить операции аффинных преобразований, что помогает распознавать повернутый
или имеющий другой масштаб образец.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pract
Для загрузки изображений в рабочее пространство MATLAB используется функция
\verb'imread':
\begin{verbatim}
>> My_image = imread('/Data/images/myimage.xbm');
\end{verbatim}
За отображение изображения на экране  отвечает функция {\tt imshow(Im, Gray)}.
Первый аргумент \verb'Im'~--- матрица--изображение, второй аргумент не является
обязательным, он содержит число уровней яркости для изображения. Если написать
\verb'imshow(Im, [])', для отображения будет использован весь диапазон значений
яркостей изображения \verb'Im'.
Сохранить изображение можно при помощи команды \verb'imwrite'.

Для просмотра, загрузки и сохранения изображений можно использовать также
imtool~--- графический интерфейс пакета\к Image Processing Toolbox\н,
который вызывается командой \verb'imtool'. Запись \verb'imtool(f)' практически
аналогична \verb'imshow(f)'.

Откройте какое--нибудь из изображений, хранящихся на жестком диске (их можно
найти при помощи поиска: командой \verb'locate .jpg', или
через графический поиск (например, при помощи Beagle), нажав сочетание клавиш {\tt
<Meta> + <F>}). Если изображение
цветное, его необходимо свести к черно--белому виду и преобразовать тип данных в
\verb'int8' (если изображение содержит другой тип данных) для упрощения работы. Затем
можно построить спектр изображения.
Действия могут быть аналогичны следующему:
\begin{verbatim}
>> RGB = imread('/Data/Misc/html/pict/6.jpg'); % Считываем
>> BW = (RGB(:,:,1) + 2*RGB(:,:,2) + RGB(:,:,3))/4; % преобразуем
>> imshow(BW) % смотрим, что получилось
\end{verbatim}

Скорее всего, гистограмма нового изображения будет узкой. Впоследствии мы
преобразуем его гистограмму.

\next
Алгоритм ДПФ изображений реализован в MATLAB при помощи функции \verb'fft2'.
Для получения спектра Фурье необходимо выполнить команду \verb'S=abs(F)',
а для его визуализации~--- \verb'imshow(fftshift(S), [])'. Для лучшей визуализации
ДПФ можно представить его в логарифмическом масштабе. Если вы выполнили центрирование
изображения при помощи функции \verb'fftshift', вернуть его к оригинальному виду
(например, для выполнения каких-либо вычислений) можно при помощи команды
\verb'ifftshift'. Обратное преобразование Фурье вычисляется при помощи команды
\verb'ifft2'.

Построим Фурье--спектр изображения и его логарифмическое преобразование,
а также логарифмическое преобразование изображения.
Логарифмическое преобразование яркости изображения реализуется в MAT\-LAB при
помощи команд
\begin{verbatim}
>> g = im2uint8(mat2gray(log(1+double(f))));
\end{verbatim}
Таким образом, необходимо ввести такой набор команд:
\begin{verbatim}
>> BW_sp = fft2(double(BW));
>> imshow(fftshift(real(BW_sp)),[])
>> imshow(fftshift(abs(BW_sp)))
>> BW_sp_log = im2uint8(mat2gray(log(1 + abs(BW_sp))));
>> imshow(fftshift(BW_sp_log))
\end{verbatim}

\next
Далее отобразим гистограмму изображения.
При работе в MATLAB следует помнить, что индексы массивов начинаются с~1, а не
с~0, как принято в большинстве языков программирования. Поэтому элементу
гистограммы с нулевой яркостью соответствует первый элемент вектора--гистограммы.
Простейший способ расчета гистограммы осуществляется при помощи функции
\verb'h = imhist(f)'. Гистограмму можно отобразить при помощи\к столбчатых диаграмм\н:
\verb'bar(horz, v, width)', где \verb'v'~-- вектор--строка, график которого
нужно построить, \verb'horz'~-- (необязательный) вектор приращений по горизонтальной
шкале (т.е. координаты середины соответствующего столбца), необязательный параметр
\verb'width' (от~0 до~1) задает относительную ширину столбца.
Итак, для отображения гистограммы необходимо набрать
\begin{verbatim}
>> h = imhist(BW);
>> bar(h)
\end{verbatim}


Эквализацию гистограммы изображения можно осуществить при помощи функции
\verb'histeq', возвращающей эквализированное изображение. Первым параметром
функции является исходное изображение, а вторым~--- количество уровней яркости
для эквализации. Если второй параметр является вектором, гистограмма подгоняется
под задаваемую им функцию. Построим гистограмму нашего изображения и его спектра и
попробуем эквализировать ее:
\begin{verbatim}
>> BW_h = histeq(BW);
>> bar(imhist(BW_h))
>> bar(imhist(real(BW_sp)));
>> BW_sp_h = histeq(real(BW_sp),256);
>> imshow(BW_sp_h)
>> bar(imhist(real(BW_sp_h)));
\end{verbatim}

\next
Линейная пространственная фильтрация в пакете Image Processing Toolbox
реализуется функцией \verb'imfilter'.
Медианная фильтрация осуществляется при помощи функции {\tt medfilt2(f, [m, n])}.
Зашумление изображения можно реализовать при помощи функции {\tt imnoise(f, 'salt \&
pepper', probab)}.

Создадим зашумленное изображение и попробуем отфильтровать его.
\begin{verbatim}
>> BW_n = imnoise(BW, 'salt & pepper', 0.1); % зашумляем BW
>> imshow(BW_n) % смотрим зашумленное изображение
>> BW_n_med0 = medfilt2(BW_n); % фильтруем по квадрату 3х3
>> imshow(BW_n_med0) % смотрим, что получилось
>> BW_n_med5 = medfilt2(BW_n,[5 5]); фильтруем по квадрату 5х5
>> imshow(BW_n_med5) % размытое изображение
\end{verbatim}

\next
Для свертки изображений разных размеров необходимо привести их к единому масштабу.
Вычислив размер расширенного изображения $P\times Q$, можно выполнить его
Фурье--преобразование при помощи функции
\begin{verbatim}
>> F = fft2(f, P, Q);
\end{verbatim}
При использовании расширения функция фильтра в частотной области также должна
иметь размер $P\times Q$.

Для вычисления размера расширенной матрицы удобно использовать следующую функцию
\verbatiminput{Matlab/06/paddedsize.m}
В комментариях описан синтаксис функции. Заметьте, что необязательно в качестве
текстового аргумента писать \verb"'pwr2'"~--- он может быть любым символом,
например, \verb"'w'".

Еще одна удобная функция \verb'lpfilter' реализует передаточные функции некоторых
низкочастотных фильтров
\verbatiminput{Matlab/06/lpfilter.m}

Для нее необходима еще одна функция: \verb'dftuv' (она строит координатную
матрицу в частотном диапазоне, аналогично построению вектора частот в предыдущей
лабораторной работе):
\verbatiminput{Matlab/06/dftuv.m}

Для большего удобства необходимо создать еще и функцию \verb'dftfilt',
позволяющую применять к изображению заданный вид частотного фильтра:
\verbatiminput{Matlab/06/dftfilt.m}

Получить передаточную функцию фильтра можно при помощи функции \verb'lpfilter',
а отфильтровать изображение внутренними средствами MATLAB (с использованием
расширения нулями)~--- при помощи команд \verb'fspecial' и \verb'imfilter'.\к
Основные шаги фильтрации в частотной области\н:
\begin{enumerate}
\item получить параметры расширения с помощью \verb'paddedsize':
$$\verb'PQ = paddedsize(size(f));'$$
\item построить преобразование Фурье с расширением:
$$\verb'F = fft2(f, PQ(1), PQ(2));'$$
\item сгенерировать функцию фильтра~$G$ размером $PQ(1)\times PQ(2)$, если фильтр
был центрирован, до фильтрации необходимо выполнить \verb'G=fftshift(G)';
\item произвести свертку в Фурье--пространстве:
$$\verb'FF = G.*F;'$$
\item найти вещественную часть обратного преобразования Фурье от $FF$:
$$\verb'ff = real(ifft2(FF));'$$
\item вырезать верхний левый прямоугольник исходных размеров:
$$\verb'ff = ff(1:size(f,1), 1:size(f,2));'$$
\end{enumerate}


Попробуем на нашем изображении некоторые ВЧ фильтры.
\begin{verbatim}
>> PQ = paddedsize(size(BW));
>> D0 = .05*PQ(1);
>> HBW = 1 - lpfilter('btw', PQ(1), PQ(2), D0, 2);
>> H = .5 + 2*HBW;
>> gbw = dftfilt(BW, HBW);
>> gbw = im2uint8(mat2gray(gbw));
>> ghf = dftfilt(BW, H);
>> ghf = im2uint8(mat2gray(ghf));
>> ghe = histeq(ghf, 256);
>> imshow(ghe);
>> figure, imshow(BW)
\end{verbatim}

\next
Функция \verb'statmoments(p, n)' позволяет вычислить центральные статистические
моменты матрицы~\verb'p' до величины~\verb'n'.

Применим теперь к нашему зашумленному изображению адаптивную медианную
фильтрацию. Попробуем несколько различных значений окна усреднения.
Функция \verb'adpmedian(g, Smax)' позволяет осуществлять адаптивную медианную
фильтрацию изображения \verb'g' с максимальным размером окна \verb'Smax'.
Листинг функции:
\verbatiminput{Matlab/06/adpmedian.m}

Теперь посмотрим, как работает адаптивная медианная фильтрация.
\begin{verbatim}
>> BW_n_amed3 = adpmedian(BW_n,3);
>> BW_n_amed5 = adpmedian(BW_n,5);
>> BW_n_amed7 = adpmedian(BW_n,7);
>> BW_n_amed15 = adpmedian(BW_n,15);
>> imshow(BW_n_amed3)
>> figure, imshow(BW_n_amed5)
>> figure, imshow(BW_n_amed7)
>> figure, imshow(BW_n_amed15)
\end{verbatim}
Сравним с <<обычной>> медианной фильтрацией с квадратом $5\times5$:
\begin{verbatim}
>> figure, imshow(BW_n_med5)
\end{verbatim}

\next
При сравнении различных подходов полезно работать с одним и тем же тестовым
изображением. Для этих целей удобно изображение <<шахматной доски>>, генерируемое
функцией \verb'checkerboard':
\begin{verbatim}
>> C = checkerboard(NP, M, N);
\end{verbatim}
генерирует изображение <<доски>> с длиной клетки~\verb'NP', числом строк~\verb'M'
и числом столбцов~\verb'N'.

Построим зашумленное изображение смазанной шахматной доски:
\begin{verbatim}
>> f = checkerboard(8); % шахматная доска полями 8х8
>> PSF = fspecial('motion', 7, 45); % ФРТ смазывания на 7 точек
>> h = imfilter(f, PSF, 'circular'); % циклическая свертка с фильтром
>> noise = imnoise(zeros(size(f)), 'gaussian', 0, .001); % шум
>> g = h + noice; % зашумленная и смазанная "доска"
\end{verbatim}

\next
Винеровская фильтрация реализуется функцией \verb'deconvwnr'. Вызванная в виде
{\tt deconvwnr(g, PSF)}, она предполагает равным нулю отношение шум/сигнал
изображения. В виде {\tt deconvwnr(g, PSF, NSPR)} она полагает, что шум/сигнал
равен константе (или массиву) \verb'NSPR'. Команда вида {\tt deconvwnr(g, PSF,
NCORR, FCORR)} предполагает известными автокорреляционные функции \verb'NCORR'
шума и \verb'FCORR' неискаженного изображения.

Попробуем применить винеровский фильтр к полученному изображению:
\begin{verbatim}
>> fr1 = deconvwnr(g, PSF); % простейшая фильтрация
>> Sn = abs(fft2(noise)).^2; % мощность шума
>> nA = sum(Sn(:))/prod(size(noise)); % средняя мощность шума
>> Sf = abs(fft2(f)).^2; % мощность изображения
>> fA = sum(Sf(:))/prod(size(f)); % средняя мощность изображения
>> R = nA/fA; % отношение шум/сигнал
>> fr2 = deconvwnr(g, PSF, R); % восстановление с учетом шума
>> NCORR = fftshift(real(ifft2(Sn))); % автокорреляционные функции
>> FCORR = fftshift(real(ifft2(Sf))); % - // -
>> fr3 = deconvwnr(g, PSF, NCORR, FCORR);
>> imshow(fr1)
>> figure, imshow(fr2)
>> figure, imshow(fr3)
>> figure, imshow(g)
\end{verbatim}
Последнее изображение оказывается очень близким к идеалу, однако, не всегда
известны все параметры, необходимые для точного восстановления. Поэтому зачастую
приходится подбирать их экспериментально.

\next
Двумерные вейвлет преобразования реализуются в MATLAB при помощи уже известного
вам Wavelet Toolbox. Можно сразу использовать консольные функции, а можно при помощи
графического интерфейса пакета сделать предварительные оценки: выбрать тип
вейвлетов для фильтрации, определить порядок фильтра и т.п.
Откройте построенное изображение (предварительно сохранив его на диск) в
окне {\it Wavelet 2D}. Поэкспериментируйте с различными вейвлетами, выбрав
наиболее подходящий метод фильтрации.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\self
\begin{enumerate}
\item Откройте какое-либо изображение при помощи \verb'imtool' (либо \verb'imread').
Если это изображение цветное, приведите его к черно--белому виду. Назовите изображение
\verb'Im'. Постройте спектр изображения, назвав его, например, \verb'Im_sp'.
Осуществите логарифмическое преобразование к изображению и его спектру, отобразите
полученное на экране.

\item Для пробного изображения постройте преобразования методом эквализации
гистограммы с функциональными зависимостями для функций $\sin(x)$, $\cos(x)$,
$\exp(x)$, $\exp(-x^2)$, $\ln(x)$ (\verb'x = [1:256]'). Например, для первой
функции это выполняется при помощи команды
\begin{verbatim}
>> Im_sin = histeq(Im, sin([1:256]));
\end{verbatim}

\item Создайте копию изображения, зашумленную шумом <<соль и перец>> с вероятностью
(\verb'probab'), равной~$0.07$. Методом медианной фильтрации получите два
очищенных изображения: в первом фильтрацию проводите по стандартному квадрату
$3\times3$, а во втором~--- по прямоугольнику $2\times4$. Отобразите результаты
на экране.

\item Наберите m-файлы, необходимые для осуществления фильтрации в частотной
области. Постройте для изображения--образца фильтрованные копии с применением
идеального НЧ фильтра, идеального ВЧ фильтра, НЧ и ВЧ фильтров Баттеуоса,
НЧ и ВЧ фильтров Гаусса (передаточные функции ВЧ и НЧ фильтров в сумме дают
единицу, поэтому для ВЧ фильтра передаточная функция $HP=1-LP$, где
$LP$~-- передаточная функция соответствующего НЧ фильтра).

\item Создайте m-файл \verb'adpmedian.m'. Очистите свое зашумленное изображение
при помощи адаптивного медианного фильтра. Сравните результат с медианной
фильтрацией.

\item Создайте изображение шахматной доски с размером ячейки $20\times20$
пикселей. Смажьте изображение на 11~точек под углом~$45\degr$. Добавьте
гауссова шума с математическим ожиданием~0 и среднеквадратичным отклонением~$0.01$.
Отфильтруйте изображение при помощи простого винеровского фильтра и винеровского
фильтра с учетом автокорреляционных функций.
Сравните результаты.

\item Откройте зашумленное и смазанное изображение шахматной доски в окне\к
Wavelet Toolbox\н. Попробуйте при помощи Вейвлет-анализа улучшить изображение,
применяя к нему различные методы фильтрации разных порядков.

\end{enumerate}

\qwest
\begin{enumerate}
\item Как в математике рассматривается любое изображение? Чем серое изображение
отличается от цветного?
\item Что такое цифровое изображение? Дайте определения основных характеристик
цифрового изображения: разрядности, размера, масштаба.
\item Объясните физический смысл формулы~\eqref{Disk_ima}, что означают
входящие в него переменные?
\item Что такое преобразования изображения в пространственной области?
Относятся ли к ним такие операции, как изменение масштаба, поворот, Фурье--фильтрация,
размытие, корреляционные преобразования?
\item Что такое гистограмма? Как при помощи операций с гистограммой можно улучшить
качество изображения?
\item Относятся ли нелинейные и дифференциальные фильтры к преобразованиям в
пространственной области?
\item Дайте определение двумерного дискретного преобразования Фурье.
Каков будет размер Фурье--спектра изображения размером~$M\times N$ точек?
\item Что характеризует амплитуда Фурье--спектра изображения? Какой физический
смысл несет фаза Фурье--спектра?
\item Чему равно значение Фурье--спектра изображения в точке с координатами~$(0,0)$?
\item Назовите основные недостатки двумерного дискретного преобразования Фурье.
\item Почему, несмотря на свои недостатки, Фурье--преобразования так активно
используются при обработке изображений в частотной области?
\item Какой физический смысл несут функция рассеяния точки и оптическая передаточная
функция; как эти две характеристики связаны между собой?
\item Под какую характеристику изображения адаптируется адаптивная медианная
фильтрация?
\item Каковы достоинства и недостатки инверсной фильтрации?
\item Какой аналог винеровской фильтрации существует в одномерной области?
\item В чем заключается основная проблема распознавания изображений?
Почему до сих пор нет автоматических систем, распознающих рукописные тексты?
\item Что такое скелет изображения?
\item Какие основные виды аффинных преобразований вы знаете?
\item Сформулируйте основные шаги фильтрации в частотной области.
\end{enumerate}
