\lr{Анализ временных рядов. Фурье и вейвлет-анализ}
\theory
Одним из распространенных и практически важных случаев связи между
аргументом и функцией является задание этой связи в виде некоторой таблицы
$(x_i, y_i)$. В таком виде обычно задаются экспериментальные данные.

На практике часто приходится
использовать табличные данные для приближенного вычисления~$у$ при любом
значении аргумента~$х$ (из некоторой области). Этой цели служит задача
приближения (аппроксимации) функций:\к заданную таблично функцию $f(x)$ требуется
приближенно заменить некоторой функцией~$g(x)$ так, чтобы отклонение~$g(x)$
от~$f(x)$ в
заданной области было наименьшим\н. Функция~$g(x)$ при этом называется\ж
аппроксимирующей\н. Если приближение строится на заданном дискретном
множестве точек~$\{x_i\}$, то аппроксимация называется\к точечной\н. К ней относятся
интерполирование, среднеквадратичное приближение и др. При построении
приближения на непрерывном множестве точек (например, на отрезке~$[a, b]$)
аппроксимация называется\к непрерывной или интегральной\н.

Для восстановления промежуточных значений функции, заданной таблично, используются различные
алгоритмы интерполяции. Простейшей является\ж линейная интерполяция\н.
При этом функция в промежутках между заданными точками интерполируется отрезками прямых
линий. Данный вид интерполяции обладает значительной погрешностью, особенно для быстро
изменяющихся функций при редком расположении контрольных точек. Разложим функцию в ряд
Тейлора
$$f(x)=f(x_0)+(x-x_0)f'(x_0)+\cdots+\frac{(x-x_0)^nf^{(n)}(x_0)}{n!}+R_n$$
и ограничимся нулевым и первым членами разложения. Тогда на каждом отрезке $[x_n,x_{n+1}]$
функцию можно задать в виде
$$f_n(x)=y_n+(x-x_n)\frac{y_{n+1}-y_n}{x_{n+1}-x_n},$$
где $y_n$~-- табличное значение функции в точке~$x_n$.
Значительно меньшую погрешность имеет\к интерполяция сплайнами\н.

\bf Сплайн\н~--- кусочная полиномиальная функция, которая на заданном отрезке может принимать
очень простую форму, в то же время имея гибкость и гладкость.
Чаще всего для интерполяции функций используются\к кубические сплайны\н, представляющие
собой набор полиномов третьей степени~$p_n(x)$, проходящих через заданные точки. На точках сшивания,
в которых один сплайн переходит в другой, на сплайны накладываются следующие ограничения:
\begin{itemize}
\item предыдущий сплайн должен переходить в следующий в точках сшивания, т.е.
$p_n(x_n)=p_{n+1}(x_n)$;
\item интерполированная функция должна быть гладкой, т.е.
$p'_n(x_n)=p'_{n+1}(x_n)$;
\item точки сшивания являются точками перегиба, т.е.
$p''_n(x_n)=0$ для всех~$n$.
\end{itemize}
Таким образом, для полиномов $p_n$, определенных на~$N-1$ отрезке имеем $4N-4$
коэффициентов. Граничные условия дают для этих коэффициентов~$3N-4$ уравнения.
Недостающие~$N$ уравнений можно получить из дополнительных условий.

Однако, для квадратичных сплайнов перечисленных условий достаточно для формирования
системы уравнений, из которой могут быть найдены все коэффициенты.

В двумерном пространстве аналогом кубических сплайнов является\ж пластинчатый сплайн\н~---
поверхность, проходящая через узловые точки и минимизирующая энергию сгиба
$$I[f(x,y)]=\iint_\mathbb{R}(f_{xx}^2+2f{xy}^2+f_{yy}^2)\,dx\,dy.$$

\next
При работе с гармоническими функциями, а также при определении спектра сигнала используются
ряды Фурье.\ж Ряд Фурье\н представляет собой бесконечный ряд с членами~--- гармоническими
функциями
$$f(x)=\sum_{n=0}^\infty a'_n\cos(nx)+\sum_{n=0}^\infty b'_n\sin(nx).$$
Коэффициенты $a_n$ и~$b_n$ рассчитываются по формулам
$$a_n=\rev\pi\Int_{-\pi}^\pi f(x)\cos(nx)\,dx,\qquad
b_n=\rev\pi\Int_{-\pi}^\pi f(x)\sin(nx)\,dx.$$
При разложении функции в ряд Фурье необходимо помнить, что функция при этом определена
на конечном отрезке. Вне этого отрезка функция будет повторяться, как периодическая.
наилучшим образом разложению в ряд Фурье поддаются гармонические и псевдогармонические
функции, при этом получается конечное число членов ряда.

При разложении временн\'ого ряда в ряд Фурье следует помнить, что если первая компонента
соответствует элементарному колебанию колебанию с заданной частотой, остальные компоненты
представляют собой высшие гармоники данного колебания, расположенные синфазно основному
(косинусные члены) и со сдвигом на~$90\degr$ (синусные члены). Значит, коэффициенты Фурье
представляют собой амплитуды элементарных колебаний, составляющих суммарный сигнал.

Получение набора коэффициентов $a_n$ и~$b_n$ на дискретном множестве точек
и восстановление функции при помощи ряда
Фурье называют\ж дискретным преобразованием Фурье\н~(ДПФ). Недостаток ДПФ в том, что при
ограничении количества членов ряда результирующая функция заметно искажается.

\bf Непрерывное преобразование Фурье\н задается формулами
$$F(k)=\FT{f(x)}\equiv\Infint f(x)\e^{-2\pi ikx}\,dx,\quad
f(x)=\IFT{F(k)}\equiv\rev{2\pi}\Infint F(k)\e^{2\pi ikx}\,dk.$$
$\FT{f}$ называют\к прямым\н, а $\IFT{F}$~---\к обратным преобразованием Фурье\н.
Физическая величина~$k$ имеет обратную по отношению к~$x$ размерность. Следовательно,
если~$x$ имеет значение времени, $k$~является частотой; если $x$~-- координата,
$k$~-- пространственная частота.
Эта особенность позволяет применять Фурье--преобразования в спектральном анализе сигналов
и изображений. Спектр сигнала совпадает с его преобразованием Фурье. Для сигнала,
полученного смешиванием нескольких гармонических сигналов, посредством преобразований Фурье
возможно определить частоту основной и побочных гармоник.

Фурье--анализ применяется и для фильтрации сигналов. Например, для отсечения высокочастотной
составляющей необходимо умножить спектр сигнала на функцию--ступеньку, значения которой до
граничной частоты~$f_0$ равно~1, а после нее~0. Последующее обратное преобразование Фурье
преобразованного таким образом спектра позволит получить отфильтрованный сигнал.

Удобна Фурье--фильтрация и для преобразования изображений. В этом случае~$x$ имеет размерность
радиус--вектора заданной точки изображения, а~$k$~--- пространственной частоты. Примерной аналогией
пространственной частоты является количество штрихов на изображении, расположенных поперек
заданного направления~$\vec k$. Таким образом, например, для удаления из изображения помех
можно отсечь высокочастотную составляющую его Фурье--образа. Для этого на образе заменяем нулями
значения~$F(x)$ во всех точках, лежащих вне окружности заданного радиуса с центром в центре образа.
Чем меньше радиус такой окружности, тем на более низких частотах будет происходить фильтрация.
Отрицательной стороной такой фильтрации является потеря высокочастотных деталей изображения
(мелких деталей, штриховок).

Так как свертка сигналов по свойству преобразования Фурье является произведением
образов этих сигналов, $a(t)\otimes b(t)\equiv \FT{a}\cdot\FT{b}=A(\nu)\cdot B(\nu)$,
преобразования Фурье широко используются в оптике и спектроскопии. Любой
оптический прибор можно рассматривать как черный ящик, в котором происходит
преобразование Фурье входного сигнала~$f(t)$, умножение его на аппаратную функцию
прибора~$A(\nu)$ (фурье--образ передаточной функции прибора), зашумление (т.е. умножение
на функцию $1+\delta(\nu)$, где $\delta$~-- случайная функция, характеризующая
спектральную мощность шума), обратное преобразование Фурье:
$$\B{f(t)}\;\Arr\; \FT{f(t)}\equiv F(\nu)\;\Arr\;
B(\nu)=F(\nu)\cdot A(\nu)\;\Arr$$
$$\Arr\; N(\nu)=B(\nu)\cdot(1+\delta(\nu))\;\Arr\;
\B{f}'(t)\equiv{\IFT{N(\nu)}}.$$

Спектральный прибор осуществляет пространственное перераспределение входящего
излучения, так что выходной сигнал является еще и функцией координаты светоприемника.
В этом случае прибор производит преобразование частотной координаты Фурье--спектра
к пространственному виду:
$$\B{f(t)}\;\Arr\; \FT{f(t)}\equiv F(\nu)\;\Arr\;
B(\nu)=F(\nu)\cdot A(\nu)\;\Arr$$
$$\Arr\; N(\nu)=B(\nu)\cdot(1+\delta(\nu))\;\Arr\;\nu\to x\;\Arr\;
\B{S}(x).$$

\next
В середине прошлого века в математике появились новые методы анализа и восстановления функций~---
использование вейвлетов (wavelet, в отечественной математике~---\ж функция--всплеск\н).\к
Вейвлеты\н~--- класс функций, использующихся для пространственной и масштабируемой локализации
заданной функции. Семейство вейвлетов может быть образовано из функции~$\psi(x)$ (ее иногда
называют <<материнским вейвлетом>>), ограниченной на конечном интервале. <<Дочерние>>
вейвлеты
$\psi^{a,b}(x)$ образуются из <<материнского>> путем сдвига и масштабирования.

Вейвлеты широко используются для сжатия изображений, так как они обладают более
гибкими свойствами по сравнению с преобразованием Фурье. Так, например, если изображение
обладает резкими границами, Фурье--образ этого изображения дает\ж краевые эффекты\н~---
полученная ступенька сглаживается, что искажает границы изображения, восстановленного
из Фурье--образа.

Отдельный вейвлет можно определить как
$$\psi^{a,b}(x)=|a|^{-1/2}\psi\Bigl(\frac{x-b}{a}\Bigr).$$
Тогда\ж базис вейвлетов\н, соответствующих функции~$f(x)$ определяется как
$$W_\psi(f)(a,b)=\rev{\sqrt a}\Infint f(t)\psi\Bigl(\frac{t-b}{a}\Bigr)\,dt.
\label{waveletb}$$

В\ж вейвлет--анализе\н важным условием является ортогональность базиса вейвлетов,
по которым раскладывается функция.

Одним из известных семейств вейвлетов являются\ж вейвлеты Хаара\н, построенные по
аналогии с матричным\к преобразованием Адамара\н (за это их называют также вейвлетами
Адамара--Хаара). <<Материнский>> вейвлет Хаара имеет вид
$$\psi(x)\equiv\begin{cases}
1,  & 0\le x\le 1/2;\\
-1, & 1/2< x\le 1;\\
0,  & \text{в других случаях.}
\end{cases}
$$
<<Дочерние>> вейвлеты задаются выражением $\psi^{j,k}(x)\equiv \psi(2^j x-k)$.
Вейвлеты Хаара являются ортогональными.

Вейвлет--фильтрация имеет б\'ольшую гибкость по сравнению с Фурье--филь\-тра\-цией.
Удаляя из вейвлет--образа члены с определенным масштабом можно исключить
шумы из сигнала. Однако, если Фурье--фильтрация позволяет исключить только
шум, подчиняющийся гармоническому закону, вейвлет--фильтрация очищает сигнал
практически от любого шума (необходимо только правильно подобрать базис вейвлетов).



\pract
Рассмотрим методы аппроксимации, предлагаемые MATLAB. Для аппроксимации одномерных
данных используется функция \verb'interp1(x,Y,xi,method)' со следующими аргументами:
\begin{itemize}
\item \verb'x'~--- массив аргументов табличной функции;
\item \verb'Y'~--- массив значений табличной функции;
\item \verb'xi'~--- значение (или массив значений) аргумента, для которого
	необходимо рассчитать приближенные значения функции;
\item \verb'method'~--- метод интерполяции (в случае отсутствия данного аргумента
	используется линейная интерполяция):
	\subitem \verb"'nearest'"~--- замена значения функции ближайшим известным
	значением;
	\subitem \verb"'linear'"~--- кусочно--линейная интерполяция;
	\subitem \verb"'spline'"~--- интерполяция кубическими сплайнами;
	\subitem \verb"'cubic'"~--- кусочно--кубическая эрмитова интерполяция.
\end{itemize}

Зададим массив аргументов \verb'x=[1:10]' и функций \verb'y=sin(x)'. Теперь рассмотрим,
как действуют различные методы интерполяции.
\begin{verbatim}
>> xi=[1:.05:10];
>> y_nearest=interp1(x,y,xi,'nearest');
>> y_linear=interp1(x,y,xi,'linear');
>> y_spline=interp1(x,y,xi,'spline');
>> y_cubic=interp1(x,y,xi,'cubic');
\end{verbatim}

Построим графики получившихся функций с подписями, соответствующими каждой
интерполяции:
\begin{verbatim}
>> plot(x,y, 'o', xi, [y_nearest; y_linear; y_spline; ...
       y_cubic],xi,sin(xi),'.')
>> legend('DATA','nearest', 'linear','spline','cubic','sinusoide')
\end{verbatim}
Как видите, наиболее близкой к реальной синусоиде оказалась интерполяция сплайнами.

Рассчитаем теперь среднее квадратичное отклонение для каждого вида интерполяции:
\begin{verbatim}
>> std(y_nearest-sin(xi))
ans =
    0.2031
>> std(y_linear-sin(xi))
ans =
    0.0618
>> std(y_spline-sin(xi))
ans =
    0.0068
>> std(y_cubic-sin(xi))
ans =
    0.0394
\end{verbatim}
Действительно, наименьшим отклонением от заданной функции обладает интерполяция
сплайнами.

Теперь рассмотрим аппроксимацию функции~$y=\exp(-x/10)\cos(x)$ на отрезке~$[1,20]$
по сетке с шагом~0.01:
\begin{verbatim}
>> x=[1:20];
>> y=exp(-x/10).*cos(x);
>> x_i=[1:.01:20];
>> tic;y_linear=interp1(x,y,xi,'linear');toc
Elapsed time is 0.001192 seconds.
>> tic;y_nearest=interp1(x,y,xi,'nearest');toc
Elapsed time is 0.001147 seconds.
>> tic;y_cubic=interp1(x,y,xi,'cubic');toc
Elapsed time is 0.003650 seconds.
>> tic;y_spline=interp1(x,y,xi,'spline');toc
Elapsed time is 0.017406 seconds.
\end{verbatim}
Функциональные скобки \verb'tic'$\cdots$\verb'toc' позволяют засечь время выполнения
расположенных между ними команд. Как видите, интерполяция сплайнами происходит в
15~раз медленнее интерполяции ближайшим числом (и такая небольшая разница возникает
лишь благодаря высокой оптимизации вычислительных процессов в MATLAB).
Проверив значения стандартного отклонения и в этом случае обнаружим значительное
превосходство интерполяции сплайнами над другими методами.

\next
Теперь рассмотрим задачу построения спектра сигналов с амплитудной и частотной
модуляциями. Пусть наши сигналы заданы на интервале $[0,100]$\,с с шагом $0.001$\,с.
Оригинальные сигналы представляют собой синусоиды с частотами $10$\,Гц и
$0.1$\,Гц. Результирующие сигналы~--- амплитудно- и частотно-модулированный
вторым первый сигнал. Получим спектры сигналов:
\begin{verbatim}
>> x=[0:0.001:99.999]; % Для "ровного" счета
>> y1=sin(x*2*pi*10); y2=sin(x*2*pi/10); % сами сигналы
>> y_AM=y1.*y2; % амплитудно модулированный сигнал
>> y_FM=sin(x*2*pi.*(10+y2/10)); % частотно модулированный сигнал
>> SP_FM=fft(y_FM); % спектр ЧМ-сигнала
>> SP_AM=fft(y_AM); % спектр АМ-сигнала
>> MAX=length(SP_AM); % длина спектрального вектора
>> scale=([1:MAX]-MAX/2)/MAX/0.001; % шкала частот
>> scale(1)=[]; SP_AM(1)=[]; SP_FM(1)=[]; % коррекция сдвига
\end{verbatim}
Особое внимание обратите на построение шкалы частот: для графического отображения
преобразования Фурье мы, как и ранее, будем использовать функцию \verb'fftshift',
центрирующую фурье-образ относительно области определения. Таким образом, если
$l$~--- длина вектора--аргумента, то центр распределения будет в ячейке с
номером $l/2$. Частотный предел образа $\nu_{max}$, согласно\ж теореме
Котельникова--Найквиста\н,
равен половине частоты дискретизации сигнала, т.е. $1/(2\Delta x)$. Следовательно,
отцентрированный (т.е. уже поделенный пополам) интервал шкалы частот необходимо
еще и умножить на отношение $\nu_{max}/l$, чтобы получить правильные пределы.
Подводя итог сказанному, получим формулу для перевода аргумента функции--сигнала
в частотный диапазон ($n$~-- номер элемента вектора):
$$\boxed{\nu(n)=\frac{n-l/2}{l\cdot\Delta x}}.$$

Постройте график спектра
\begin{verbatim}
>> plot(scale,fftshift(abs(SP_AM).^2))
\end{verbatim}
Как видите, спектр АМ-сигнала представляет собой четыре пика: расстояние между
боковыми пиками равно удвоенной частоте модулирующего сигнала, а расстояние между
центрами боковых пиков равно удвоенной частоте несущего сигнала (можете это
проверить). Вершины боковых пиков отстоят на $\pm0.1$\,Гц от несущего сигнала
$\pm10$\,Гц. Постройте на одном графике спектры модулирующего, несущего и АМ
сигналов:
\begin{verbatim}
>> SP1=fft(y1); SP1(1)=[];
>> SP2=fft(y1); SP2(1)=[];
>> plot(scale,[fftshift(abs(SP_AM)); fftshift(abs(SP1));
>> fftshift(abs(SP2))])
\end{verbatim}

Теперь отобразим спектр ЧМ-сигнала.
\begin{verbatim}
>> FM=fftshift(abs(SP_FM).^2); % спектр
>> plot(scale,FM) % график всего спектра
>> plot(scale(50000:50500),FM(50000:50500)) % подробней
\end{verbatim}
Теперь спектр представляет собой довольно широкую полосу частот около несущей.

\next
\label{Fourier_filtering}
Попробуем применить простейшую Фурье--фильтрацию к зашумленному сигналу.
\begin{verbatim}
>> sig=cos(2*pi*t/30).*sin(2*pi*t*7).*log(1+t); % наш "сигнал"
>> noicy=awgn(sig,10,'measured'); % зашумленная копия сигнала
>> plot(t,[sig;noicy]) % посмотрим, что получилось
>> SP=fft(sig); % спектр сигнала
>> SP_n=fft(noicy); % спектр зашумленного сигнала
>> L=length(SP); % длина вектора данных
>> freq=([1:L]-L/2)/L/.01; % переходим к пространству частот
>> plot(freq,[fftshift(abs(SP));fftshift(abs(SP_n))]); % спектры
>> SP_f=SP_n; % инициализируем отфильтрованный спектр
>> SP_f(find((real(SP).^2+imag(SP).^2)<7))=0; % удаляем составляющие
                  % с низкой мощностью (менее 7)
>> plot(freq,fftshift(abs(SP_f))); % посмотрим отфильтрованный спектр
>> sig_f=real(ifft2(SP_f)); % восстановим сигнала
>> plot(t,sig_f) % отобразим восстановленный сигнал
>> plot(t,[noicy;sig_f]) % вместе с зашумленным
>> plot(t,[noicy;sig_f;sig]) % и все вместе
>> std(sig-sig_f) % погрешность
ans =
    0.0744
\end{verbatim}
В данном случае мощность шумов была невысокой, поэтому фильтрация маломощных
сигналов почти не повлияла на основной сигнал.

Другой вариант фильтрации~--- усечение высокочастотной составляющей.
Отсечем все гармоники с частотами выше 15\,Гц:
\begin{verbatim}
>> SP_f1=fftshift(SP_n); % сдвигаем спектр для фильтрации
>> SP_f1(find(abs(freq)>15))=0; % обнуляем высокие частоты
>> sig_f1=real(ifft2(ifftshift(SP_f1))); % восстанавливаем сигнал
>> plot(t,[sig_f1;sig]) % сравниваем с сигналом
>> plot(t,[sig_f1;noicy]) % и с зашумленным сигналом
\end{verbatim}

Это аналогично вычислению шума и вычитанию его из сигнала:
\begin{verbatim}
>> SP_f1=fftshift(SP_n);
>> SP_f1(find(abs(freq)<15))=0;
>> pure_noice=real(ifft2(ifftshift(SP_f1)));
>> sig_f2=noicy - pure_noice;
>> plot(t,[sig_f2-sig_f1])
\end{verbatim}

Результат еще лучше мы сможем получить, если извлечем из спектра только узкую
область, содержащую максимумы спектральной плотности:
\begin{verbatim}
>> SP_f1=fftshift(SP_n);
>> SP_f1(find(abs(abs(freq)-7)<1))=0;
>> pure_noice=real(ifft2(ifftshift(SP_f1)));
>> sig_f2=noicy - pure_noice;
>> plot(t,[sig_f2;sig])
\end{verbatim}

Можно попытаться выделить низкочастотную составляющую сигнала (осуществить\к
детектирование АМ сигнала\н):
\begin{verbatim}
>> SP_n=fft(abs(noicy)); % получаем спектр сигнала
>> SP_f1=fftshift(SP_n); % подготавливаем
>> SP_f1(find(abs(freq)>3))=0; % убираем несущую
>> sig_f2=real(ifft2(ifftshift(SP_f1))); % детектируем
>> plot(t,[sig_f2;sig])
\end{verbatim}

\next
Следующая задача часто встает перед астрофизиком: имея модель спектра в лабораторной
системе отсчета и реальный спектр звезды определить смещение спектра звезды
относительно лабораторного (т.е. найти лучевую скорость звезды).

Сгенерируем <<псевдоспектр>> звезды и две его зашумленные копии с уровнями
$S/N$~50\,дБ и~10\,дБ. Попробуем определить смещение <<спектра>> относительно
лабораторного при помощи Фурье--анализа.

\linenumbers*
\label{SP_mv}
\begin{verbatim}
>> x=[1:1000]; % абсциссы спектра
>> y=normpdf(x,400,200)*5000; % "континуум"
>> gaussian=normpdf(x,500,10)*25; % профиль спектральной "линии"
>> dotz=[200,310,487,500,512,515,689,891,900,901,950];
>> deltaz=zeros(1, 1000);
>> deltaz(dotz)=1;
>> deltaz(round(dotz/1.1))=1;
>> deltaz(round(dotz/1.3))=1;
>> deltaz(round(dotz/2))=1;
>> deltaz(round(dotz/5))=1;
>> deltaz(round(dotz/7))=1;
>> deltaz(round(dotz/11))=1;
>> Fdeltaz=fft(deltaz);
>> Fgaussian=fft(gaussian);
>> Spectra=ifft(Fdeltaz.*Fgaussian)+y; % собственно "спектр"
>> plot(Spectra)
>> Spectra_10=awgn(Spectra,10,'measured');
>> Spectra_50=awgn(Spectra,50,'measured');
>> Spectra_10_moved=zeros(1,1000);
>> Spectra_50_moved=zeros(1,1000);
>> Spectra_10_moved(111:end)=Spectra_10(1:890); % сдвинутые копии
>> Spectra_50_moved(111:end)=Spectra_50(1:890); % с зашумлением
>> [corr,lags] = xcorr(Spectra_50_moved,Spectra);
>> plot(lags,corr)
>> lags(find(corr==max(corr))) % положение сдвига
ans =
   110
>> [corr10,lags10] = xcorr(Spectra_10_moved,Spectra);
>> lags10(find(corr10==max(corr10)))
ans =
   109
>> [corr15,lags15] = xcorr(Spectra_10_moved,Spectra_50);
>> lags15(find(corr15==max(corr15)))
ans =
   109
\end{verbatim}
\nolinenumbers
\begin{pict}%\vspace*{-1cm}
\includegraphics[width=.7\textwidth]{Matlab/05/spectra}
\label{spectra}%\vspace*{-1cm}
\caption{Сгенерированный псевдоспектр (\tt plot(Spectra)\rm)}
\end{pict}

Вектор \verb'dotz' содержит базовые координаты для расчета положения <<линий>>
в спектре. Инициализируя некоторые компоненты вектора \verb'deltaz' единицами
и сворачивая его с гауссианой, получим профиль <<эмиссионных линий>>, сложив
который с <<непрерывным спектром>> сформируем собственно псевдоспектр.
Все используемые команды должны быть вам уже известны. Как видите, даже сигнал
с $S/N=10\,$дБ содержит достаточно информации для точного определения сдвига.
Координата максимума кросс--корреляционной функции может немного отличаться от~110
из-за того, что сдвинутые компоненты потеряли часть информации (недостающие
данные мы просто заменили нулями).

\next
Теперь попробуем восстановить сигнал при помощи вейвлет--анализа, а также
определить сдвиг. Сохраните вектор сдвинутого зашумленного спектра:
\begin{verbatim}
>> save Spectra_moved Spectra_10_moved
\end{verbatim}

Теперь в меню MATLAB\к Start\н выберите\к Toolboxes~\Arr Wavelet~\Arr
Wavelet toolbox main menu\н. В появившемся окне нажмите кнопку\к
Wavelet~1--D\н. Откроется окно одномерных Wavelet--преобразований. Загрузите
данные (\it{}File~\Arr Load~\Arr Signal~\Arr{} \tt Spectra\_moved\rm).

На панели справа из выпадающего меню\к Wavelet\н выберите\к dmey\н (дискретные
вейвлеты Мейера)~--- эти вейвлеты лучше всего удовлетворяют задаче фильтрации
астрофизических спектров. Из меню\к Level\н выберите четвертый уровень.
Нажмите кнопку\к Analize\н. Вы увидите графики аппроксимирующего~(a) и
детализирующих~(d) коэффициентов разложения <<спектра>> по вейвлетам Мейера.
Аппроксимирующий коэффициент несет в себе низкочастотную составляющую (огибающую),
детализирующие~--- содержат высокочастотные составляющие (причем коэффициент~d1
явно содержит шум). Как видите, аппроксимирующий коэффициент почти соответствует
нашему спектру.

Однако, при помощи\к Wavelet toolbox\н можно осуществлять
wavelet--де\-ком\-по\-зи\-цию
и в командной строке при помощи команд \verb'wavedec' и~\verb'wrcoef'.
Создадим вектор--огибающую <<зашумленного спектра>>:
\begin{verbatim}
>> [C,L]=wavedec(Spectra_10_moved,4,'dmey'); %декомпозиция сигнала
>> approx10=wrcoef('a',C,L,'dmey',4); %аппроксимирующий коэффициент
>> plot(approx10) % посмотрим, что получилось
\end{verbatim}
а также вектор--огибающую <<лабораторного спектра>>:
\begin{verbatim}
>> [C,L] = wavedec(Spectra,4,'dmey');
>> approx = wrcoef('a',C,L,'dmey',4);
>> plot(approx)
\end{verbatim}
и проверим, чему равен <<сдвиг>>
\begin{verbatim}
>> [corrw,lagsw] = xcorr(approx10,approx);
>> lagsw(find(corrw==max(corrw)))
ans =
   109
\end{verbatim}

\self
\begin{enumerate}
\item
Затабулируйте показательную функцию на отрезке $[6,14]$ с шагом~0.1.
Вычислите теперь при помощи этой таблицы значение произведения $X=1097\cdot1013$
(воспользуйтесь свойством логарифмов: $\ln X=\ln1097+\ln1013$). Для нахождения
значений $\ln1097$ и $\ln1013$ воспользуйтесь аппроксимацией сплайнами.
Аналогично, при помощи аппроксимации сплайнами вычислите~$X$.\к Для замены
экспоненциальной функции на логарифмическую при вычислении приближенного
значения логарифмов меняйте местами~$x$ и~$y$ при вызове функции
\verb'interp1'. Значение~$X$ найдите, интерполируя показательную функцию\н.

\item
Создайте вектор--сигнал, представляющий собой сумму двух синусоид с~$\nu_1=50$\,Гц
и~$\nu_2=120\,$Гц на промежутке $t\in[0,0.25]\,$с с периодом
дискретизации~$0.001\,$с. Добавьте к нему аддитивного нормального шума:
\begin{verbatim}
y = y + 2*randn(size(t));
\end{verbatim}
Постройте спектр итогового сигнала, определите по спектру частоты исходных
сигналов.

\item
Выполните упражнение по фильтрации сигнала~(стр.~\pageref{Fourier_filtering}),
задав в качестве граничной мощности 30. Сравните полученный сигнал с оригиналом.
Рассчитайте среднеквадратичное отклонение отфильтрованного сигнала от оригинала
(0.06).

\item
Создайте спектр как в упражнении со стр.~\pageref{SP_mv} и его зашумленную
копию с~$S/N=0\,$дБ, сдвинутую на 110 единиц вправо. Определите этот сдвиг при
помощи кросс--корреляционной функции~(117).

\item
Теперь определите для этого же спектра сдвиг при помощи вейвлет--де\-ком\-по\-зиции
вейвлетами Мейера на четвертом уровне, построив кросс--кор\-ре\-ля\-ци\-он\-ную функцию
для четвертых аппроксимирующих коэффициентов~(118). Затем~--- используя
кросс--корреляционную функцию суммы четвертого аппроксимирующего и четвертого
детализирующего коэффициентов~(115). Детализирующие коэффициенты строятся путем
указания ключа~\verb"'d'":
\begin{verbatim}
>> approxd = wrcoef('d',C,L,'dmey',4);
\end{verbatim}

\item
Создайте спектр, сдвинутый на 2 единицы относительно исходного (зашумленного с
$S/N=0\,$дБ):
\begin{verbatim}
>> Spectra_00_moved=zeros(1,1000);
>> Spectra_00_moved(3:end)=Spectra_0(1:998);
\end{verbatim}
При помощи вейвлет--декомпозиции на пятом уровне с использованием только
пятого аппроксимирующего коэффициента определите сдвиг относительно модельного
спектра~(3). Также определите сдвиг из кросс--корреляционной функции~(9).
% >> [C,L] = wavedec(Spectra,5,'dmey');
% >> app=wrcoef('a',C,L,'dmey',5);
% >> [C,L] = wavedec(Spectra_00_moved,5,'dmey');
% >> approx00 = wrcoef('a',C,L,'dmey',5);

\item
Создайте зашумленную копию лабораторного сигнала с $S/N=-10\,$дБ. Проведите
вейвлет--анализ этого сигнала при помощи интерактивного окна Wawelet toolbox.
Сдвиньте его на 57 единиц вправо и попытайтесь определить сдвиг при помощи
кросс--корреляционной функции аппроксимирующих коэффициентов
вейвлет--декомпозиции получившегося и лабораторного сигналов.
\end{enumerate}

\qwest
\begin{enumerate}
\item Дайте определение операциям аппроксимации, интерполяции, экстраполяции.
\item В чем сходство и в чем различие аппроксимации и интерполяции?
Возможно ли, чтобы аппроксимирующая кривая совпадала с интерполяционной?
\item Какие функциональные зависимости в наилучшей степени подлежат
линейной интерполяции? В каких случаях линейная интерполяция даст значительную
ошибку?
\item Перечислите основные граничные условия, позволяющие произвести интерполяцию
квадратичными, кубическими сплайнами. Можно ли считать данные виды интерполяции
однозначными?
\item Напишите формулы, использующиеся для разложения функции в ряд Фурье,
формулы прямого и обратного непрерывного преобразования Фурье.
\item Назовите достоинства и недостатки Фурье--анализа. Почему Фурье--анализ
имеет очень широкое применение, несмотря на свои недостатки?
\item В чем заключается преимущество вейвлет--анализа над Фурье--анализом?
\item Как строится базис дочерних вейвлетов? Всегда ли необходимо соблюдать
ортогональность базиса вейвлетов?
\item Как определить глубину рекурсии при вейвлет--анализе заданного ряда
данных?
\item Какую информацию несет набор аппроксимирующих коэффициентов при
вейвлет--анализе ряда данных? Что содержит в себе набор последних детализирующих
коэффициентов?
\item Можно ли использовать вейвлет--анализ для частотной фильтрации сигнала?
\item Сформулируйте теорему Котельникова--Найквиста. Для чего при дискретизации
звукозаписей частоту дискретизации устанавливают равной $44.1\div48\,$кГц, несмотря
на то, что человек не слышит частот свыше $10\div20\,$кГц (и звуковая аппаратура
даже Hi-End класса имеет глубокий завал на частотах свыше $18\,$кГц)?
\item Как при помощи Фурье--фильтрации можно вычесть из сигнала его среднюю
величину? Очистить от шумов? Провести АМ--детектирование?
\item Почему даже при сильном зашумлении двух копий одного и того же сигнала
из вида их корреляционной функции можно определить сдвиг между сигналами?
\end{enumerate}
